var smsCodeWindow={};jQuery(document).ready(function($){smsCodeWindow.close=function(){parent.taxi.ordering.unlock();};smsCodeWindow.setStatusMessage=function(message){var html='';if(message!==''){html='<p>'+message+'</p>';}
if($('#statusLine').length>0){$('#statusLine').html(html);}else{$('#errorResult').after('<div id="statusLine">'+html+'</div>');}
};smsCodeWindow.setErrorMessage=function(message){$('#errorResult').html(message);};$('#smsSubmit').on('click',function(event){smsCodeWindow.setStatusMessage('отправка ...');event.stopPropagation();event.preventDefault();var code=$('#smsCode').val();var phone=parent.$('#FIELD_TEL').val();var process=parent.window.taxi.ordering;process.sendToClient('validateCommand',{command:'login',paramsToValidate:{phone:phone,smsCode:code}},function(validationResult){if(validationResult.hasErrors){smsCodeWindow.setErrorMessage(validationResult.errorsInfo.summaryText);}else{process.sendToClient('login',{phone:phone,smsCode:code},function(loginResult){  if(loginResult.isAuthorizedNow&&loginResult.success){$('.remodal-wrapper').click();process.afterLogin(loginResult);process.unlock();process.createOrder(process._lastValidationResult);}else{smsCodeWindow.setStatusMessage('');if(loginResult.text){smsCodeWindow.setErrorMessage(loginResult.text);}else{smsCodeWindow.setErrorMessage('Ошибка авторизации: код может быть неверным?');}}},function(){smsCodeWindow.setStatusMessage('');alert('Внутренняя ошибка при отправке кода');smsCodeWindow.setErrorMessage('Внутренняя ошибка при отправке кода');});}});});});