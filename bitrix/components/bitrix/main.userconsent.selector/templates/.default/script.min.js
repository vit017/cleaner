var MainUserConsentSelectorManager=function(t){this.selectors=[];this.init=function(t){this.actionRequestUrl=t.actionRequestUrl;this.initSlider();var i=document.querySelectorAll("[data-bx-user-consent-selector]");i=BX.convert.nodeListToArray(i);i.forEach(this.initByContext,this)};this.initByContext=function(t){var i=t.querySelector("select[data-bx-selector]");var e=t.querySelector("a[data-bx-link-edit]");var r=t.querySelector("a[data-bx-link-view]");if(!i||!e||!r){return}this.selectors.push(i);BX.bind(i,"change",this.onChange.bind(this,i,e,r));this.onChange(i,e,r);this.initSliderButtons(t)};this.onChange=function(t,i,e){i.style.display=t.value?"":"none";e.style.display=t.value?"":"none";this.fillHrefByTemplate(i,t.value);this.fillHrefByTemplate(e,t.value)};this.fillHrefByTemplate=function(t,i){var e=t.getAttribute("data-bx-link-tmpl");if(!e){return}t.href=e.replace(new RegExp("#id#","g"),i)};this.fillDropDownControl=function(t,i,e){i=i||[];var r=t.children[0];t.innerHTML="";if(e&&r){t.appendChild(r)}i.forEach(function(i){if(!i||!i.caption){return}var e=document.createElement("option");e.value=i.value;e.selected=!!i.selected;e.innerText=i.caption;t.appendChild(e)})};this.initSliderButtons=function(t){var i=t.querySelectorAll("[data-bx-slider-href]");i=BX.convert.nodeListToArray(i);i.forEach(this.slider.bindOpen,this.slider)};this.initSlider=function(){if(!top.BX.Bitrix24||!top.BX.Bitrix24.Slider){return}this.slider.caller=this;top.BX.addCustomEvent(top,"main-user-consent-to-list",function(){if(!top||!top.BX||!top.BX.Bitrix24||!top.BX.Bitrix24.Slider){return}top.BX.Bitrix24.Slider.close()})};this.onSliderClose=function(){this.sendActionRequest("getAgreements",{},function(t){if(!t.list){return}this.selectors.forEach(function(i){var e=i.value;if(!e){e=t.list[0].ID}var r=t.list.map(function(t){return{caption:t.NAME,value:t.ID,selected:t.ID==e}});this.fillDropDownControl(i,r,true);BX.fireEvent(i,"change")},this)})};this.slider={caller:null,init:function(t){if(!top.BX.Bitrix24||!top.BX.Bitrix24.Slider){return}top.BX.Bitrix24.PageSlider.bindAnchors({rules:[{condition:t.condition,loader:t.loader,stopParameters:[]}]})},onSaved:function(){if(!top||!top.BX||!top.BX.Bitrix24||!top.BX.Bitrix24.Slider){return}this.onClose();top.BX.Bitrix24.Slider.close();top.BX.Bitrix24.Slider.resetLastOpenPage();top.BX.Bitrix24.Slider.removeOpenPage()},onClose:function(){if(this.caller&&this.caller.onSliderClose){this.caller.onSliderClose.apply(this.caller)}},bindOpen:function(t){if(!top.BX.Bitrix24||!top.BX.Bitrix24.Slider){return}BX.bind(t,"click",this.openHref.bind(this,t))},openHref:function(t,i){i.preventDefault();this.open(t.getAttribute("href"),t.getAttribute("data-bx-slider-reload"))},open:function(t,i){if(!top||!top.BX||!top.BX.Bitrix24||!top.BX.Bitrix24.Slider){return}top.BX.Bitrix24.Slider.open(t);if(i){var e=function(){if(!top||!top.BX||!top.BX.Bitrix24||!top.BX.Bitrix24.Slider||!top.BX.Bitrix24.Slider.getCurrentPage()){return}var t=top.BX.Bitrix24.Slider.getCurrentPage().getWindow();t.BX.addCustomEvent(t,"BX.Bitrix24.PageSlider:onClose",this.onClose.bind(this))};BX.bind(top.BX.Bitrix24.Slider.getCurrentPage().iframe,"load",e.bind(this));top.BX.addCustomEvent(top,"main-user-consent-saved",this.onSaved.bind(this))}}};this.sendActionRequest=function(t,i,e,r){e=e||null;r=r||null;i.action=t;i.sessid=BX.bitrix_sessid();i.action=t;BX.ajax({url:this.actionRequestUrl,method:"POST",data:i,timeout:10,dataType:"json",processData:true,onsuccess:BX.proxy(function(t){t=t||{};if(t.error){r.apply(this,[t])}else if(e){e.apply(this,[t])}},this),onfailure:BX.proxy(function(){var t={error:true,text:""};if(r){r.apply(this,[t])}},this)})};this.init(t)};
//# sourceMappingURL=script.map.js